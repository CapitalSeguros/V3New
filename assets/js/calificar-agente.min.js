var baseUrl = "";

	$(document).ready(function(){
        $('.answer-quiz').click(function() {
            const question = $(this).data('num');
            if ($('#q-'+question).hasClass('not-response')) {
                $('#q-'+question).removeClass('not-response');
            }
        })

        /*$('.check-select').click(function() {
            const id = $(this).attr('name');
            const type = $(this).data('other');
            if (type == '1') { $('#otherOp'+id).toggleClass('show'); }            
        })*/

        $('.check-btn').click(function() {
            const id = $(this).attr('for');
            const check = $('#'+id).prop('checked');
            console.log(id, check);
            if (check) { $(this).addClass('active-op'); }
            else { $(this).removeClass('active-op'); }
        })

        $('#subsidiary').change(function() {
            var location = "";
            switch(this.value) {
                case '1':
                    location = `Calle 27 No. 164-CX 36 Y 38, Buenavista, 97127 Mérida, Yuc.`;
                    break;
                case '2':
                    location = `Calle 20 44-1 X 1-F Y 1-G Col México Norte C.P. 97128 Av. Líbano 44 Las Dalias I, Mérida, Yuc.`;
                    break;
                case '3':
                    location = ``;
                    break;
            }
            $('#location').text(location);
        })

        baseUrl = $("#base_url").attr("data-base-url") + 'calificacionAgente';
        //console.log(baseUrl);

        //-----------------------------------------------------------------------

        $(document).bind("contextmenu",function(e){ return false; })

        $('#subsidiary').change();
	})

    function save_answers(mode) {
        let client = document.getElementsByName('client-info');
        let input = document.getElementsByClassName('answer-quiz');
        let insert = [];
        let values = [];
        let empty = [];
        var empty_t = "";
        var empty_o = "";
        var text = "";
        //Operation
        for (let i=0;i<client.length;i++) {
            const val = client[i].value;
            insert.push(val);
            if (val == 0) {
                if (text != 0) { text += ", "; }
                text += "el " + client[i].title;
            }
        }
        for (let i=0;i<input.length;i++) {
            const numQ = $(input[i]).data('num');
            const idQ = input[i].name;
            const type = $(input[i]).data('type');
            const other = $(input[i]).data('other');
            let count = document.getElementsByName(idQ);
            let add = {};
            if (input[i].checked && type != 5 || type == 5 && input[i].value != 0) {
                add['question'] = idQ;
                //add['answer'] = $(input[i]).data('resp');
                add['other'] = "";
                add['type'] = type;
                add['value'] = input[i].value;

                if (other != "0") {
                    const val_other = $('#other-'+idQ).val();
                    add['other'] = val_other;
                    if (val_other == 0) {
                        if (empty_o != 0) { empty_o += ", "; }
                        empty_o += "Pregunta " + numQ;
                    }
                }
                values.push(add);
            }
            else {
                var no_resp = 0;
                if (!empty_t.includes(numQ)) {
                    for (let j=0;j<count.length;j++) {
                        if (!count[j].checked) { no_resp++; }
                    }
                    if (no_resp == count.length) {
                        if (empty_t != 0) { empty_t = empty_t + ", "; }
                        empty_t = empty_t + ("Pregunta " + numQ);
                        empty.push(numQ);
                    }
                }
            }
        }
        console.log(insert, values, empty);
        //Verification
        if (text != 0) {
            return Swal.fire("¡Espera!", "Parece que no has escrito " + text + ".", "warning");
        }
        if (empty != 0) {
            empty.forEach((e) => {
                $('#q-'+e).addClass('not-response');
            })
            return Swal.fire("¡Espera!", "No has respondido todas las preguntas, te falta: " + empty_t + ".", "warning"); 
        }
        else if (empty_o != 0) {
            return Swal.fire("¡Espera!", "Parece que no has escrito la respuesta en las siguientes preguntas: " + empty_o + ".", "warning");
        }
        else {
            console.log(insert, values);
        }
        //Send Information
        if (mode == "client") {
            $.ajax({
                type: "POST",
                url: `${baseUrl}/insertDataEvaluation`,
                data: {
                    in: insert,
                    rp: values
                },
                beforeSend: (load) => {
                    $('#SpinnerBar').prop('hidden',false);
                },
                success: (data) => {
                    const r = JSON.parse(data);
                    console.log(r);
                    $('#SpinnerBar').prop('hidden',true);
                    if (r['status'] != false) {
                      Swal.fire("¡Enviado!", "Respuestas enviadas con éxito.", "success");
                    }
                    else {
                      Swal.fire("¡Uups!", "Parece que ocurrió un conflicto al intentar enviar. Inténtelo nuevamente.", "error");
                    }
                },
                error: (error) => {
                    console.log(error);
                    $('#SpinnerBar').prop('hidden',true);
                    Swal.fire("¡Vaya!", "Hay problemas al intentar enviar. Favor de reportarlo.", "error");
                }
            })
        }
    }